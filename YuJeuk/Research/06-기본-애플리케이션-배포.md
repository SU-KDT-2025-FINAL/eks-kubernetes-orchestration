# ê¸°ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

## ğŸš€ 5.1 YAML íŒŒì¼ì„ ì‚¬ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

### ê°„ë‹¨í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

#### nginx Deployment ìƒì„±
```yaml
# nginx-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3  # Pod 3ê°œ ì‹¤í–‰
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.20
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "250m"
          limits:
            memory: "128Mi"
            cpu: "500m"
```

#### Service ìƒì„±ìœ¼ë¡œ ì™¸ë¶€ ì ‘ê·¼ í—ˆìš©
```yaml
# nginx-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  labels:
    app: nginx
spec:
  selector:
    app: nginx
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
  type: LoadBalancer
```

### ë°°í¬ ì‹¤í–‰
```bash
# YAML íŒŒì¼ ìƒì„± (ìœ„ ë‚´ìš©ì„ ê°ê° íŒŒì¼ë¡œ ì €ì¥)
# nginx-deployment.yamlê³¼ nginx-service.yaml íŒŒì¼ ìƒì„±

# Deployment ë°°í¬
kubectl apply -f nginx-deployment.yaml
# deployment.apps/nginx-deployment created

# Service ë°°í¬
kubectl apply -f nginx-service.yaml
# service/nginx-service created

# ë˜ëŠ” í•œ ë²ˆì— ë°°í¬
kubectl apply -f nginx-deployment.yaml -f nginx-service.yaml
```

## ğŸ“Š 5.2 ë°°í¬ ìƒíƒœ í™•ì¸ ë° ëª¨ë‹ˆí„°ë§

### ê¸°ë³¸ ìƒíƒœ í™•ì¸
```bash
# Deployment ìƒíƒœ í™•ì¸
kubectl get deployments
# NAME               READY   UP-TO-DATE   AVAILABLE   AGE
# nginx-deployment   3/3     3            3           2m

# Pod ìƒíƒœ í™•ì¸
kubectl get pods
# NAME                                READY   STATUS    RESTARTS   AGE
# nginx-deployment-xxxxxxxxxx-xxxxx   1/1     Running   0          2m
# nginx-deployment-xxxxxxxxxx-yyyyy   1/1     Running   0          2m
# nginx-deployment-xxxxxxxxxx-zzzzz   1/1     Running   0          2m

# Service ìƒíƒœ í™•ì¸
kubectl get services
# NAME            TYPE           CLUSTER-IP      EXTERNAL-IP                                                                   PORT(S)        AGE
# kubernetes      ClusterIP      10.100.0.1      <none>                                                                        443/TCP        1h
# nginx-service   LoadBalancer   10.100.123.45   a1b2c3d4e5f6g7h8-123456789.ap-northeast-2.elb.amazonaws.com                80:31234/TCP   3m
```

### ìƒì„¸ ì •ë³´ í™•ì¸
```bash
# Deployment ìƒì„¸ ì •ë³´
kubectl describe deployment nginx-deployment

# Pod ìƒì„¸ ì •ë³´ (íŠ¹ì • Pod)
kubectl describe pod nginx-deployment-xxxxxxxxxx-xxxxx

# Service ìƒì„¸ ì •ë³´
kubectl describe service nginx-service

# ëª¨ë“  ë¦¬ì†ŒìŠ¤ í•œ ë²ˆì— í™•ì¸
kubectl get all -l app=nginx
```

### ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
```bash
# Pod ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
kubectl get pods -w

# ë¡œê·¸ í™•ì¸
kubectl logs -f deployment/nginx-deployment

# íŠ¹ì • Pod ë¡œê·¸ í™•ì¸
kubectl logs nginx-deployment-xxxxxxxxxx-xxxxx

# ì—¬ëŸ¬ Pod ë¡œê·¸ ë™ì‹œ í™•ì¸
kubectl logs -l app=nginx --tail=10
```

## ğŸŒ 5.3 ì™¸ë¶€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸

### LoadBalancer ì ‘ê·¼
```bash
# External IP í™•ì¸ (ëª‡ ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŒ)
kubectl get service nginx-service
# EXTERNAL-IPê°€ <pending>ì—ì„œ ì‹¤ì œ URLë¡œ ë³€ê²½ë  ë•Œê¹Œì§€ ëŒ€ê¸°

# ì™¸ë¶€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
curl http://a1b2c3d4e5f6g7h8-123456789.ap-northeast-2.elb.amazonaws.com

# ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼
# http://a1b2c3d4e5f6g7h8-123456789.ap-northeast-2.elb.amazonaws.com
```

### ë¡œë“œ ë°¸ëŸ°ì‹± í™•ì¸
```bash
# ì—¬ëŸ¬ ë²ˆ ìš”ì²­í•˜ì—¬ ë‹¤ë¥¸ Podë¡œ ë¶„ì‚°ë˜ëŠ”ì§€ í™•ì¸
for i in {1..10}; do
  curl -s http://your-loadbalancer-url | grep -o 'nginx/[0-9.]*'
done
```

## ğŸ”„ 5.4 ì• í”Œë¦¬ì¼€ì´ì…˜ ì—…ë°ì´íŠ¸ (ë¡¤ë§ ì—…ë°ì´íŠ¸)

### ì´ë¯¸ì§€ ë²„ì „ ì—…ë°ì´íŠ¸
```bash
# nginx ë²„ì „ì„ 1.20ì—ì„œ 1.21ë¡œ ì—…ë°ì´íŠ¸
kubectl set image deployment/nginx-deployment nginx=nginx:1.21

# ë¡¤ì•„ì›ƒ ìƒíƒœ í™•ì¸
kubectl rollout status deployment/nginx-deployment
# deployment "nginx-deployment" successfully rolled out

# ë¡¤ì•„ì›ƒ íˆìŠ¤í† ë¦¬ í™•ì¸
kubectl rollout history deployment/nginx-deployment
```

### ë¡¤ë§ ì—…ë°ì´íŠ¸ ê³¼ì • ê´€ì°°
```bash
# ì—…ë°ì´íŠ¸ ê³¼ì •ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ì°°
kubectl get pods -w

# ì—…ë°ì´íŠ¸ ê³¼ì •ì—ì„œ ì¼ì–´ë‚˜ëŠ” ì¼:
# 1. ìƒˆë¡œìš´ Pod ìƒì„± (nginx:1.21)
# 2. ìƒˆ Podê°€ Ready ìƒíƒœê°€ ë˜ë©´
# 3. ê¸°ì¡´ Pod í•˜ë‚˜ì”© ì¢…ë£Œ
# 4. ëª¨ë“  Podê°€ ìƒˆ ë²„ì „ìœ¼ë¡œ êµì²´ë  ë•Œê¹Œì§€ ë°˜ë³µ
```

### ë¡¤ë°± (í•„ìš” ì‹œ)
```bash
# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deployment/nginx-deployment

# íŠ¹ì • ë¦¬ë¹„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deployment/nginx-deployment --to-revision=1

# ë¡¤ë°± ìƒíƒœ í™•ì¸
kubectl rollout status deployment/nginx-deployment
```

## ğŸ“ˆ 5.5 ìŠ¤ì¼€ì¼ë§ (í™•ì¥/ì¶•ì†Œ)

### ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§
```bash
# Pod ìˆ˜ë¥¼ 3ê°œì—ì„œ 5ê°œë¡œ ì¦ê°€
kubectl scale deployment nginx-deployment --replicas=5

# ìŠ¤ì¼€ì¼ë§ ê²°ê³¼ í™•ì¸
kubectl get pods
# ìƒˆë¡œìš´ Pod 2ê°œê°€ ì¶”ê°€ë¡œ ìƒì„±ë¨

# Pod ìˆ˜ë¥¼ ë‹¤ì‹œ 2ê°œë¡œ ê°ì†Œ
kubectl scale deployment nginx-deployment --replicas=2

# ê°ì†Œ ê³¼ì • í™•ì¸
kubectl get pods -w
# 3ê°œì˜ Podê°€ ì¢…ë£Œë¨
```

### YAML íŒŒì¼ ìˆ˜ì •ì„ í†µí•œ ìŠ¤ì¼€ì¼ë§
```yaml
# nginx-deployment.yaml íŒŒì¼ì—ì„œ replicas ê°’ ë³€ê²½
spec:
  replicas: 4  # 3ì—ì„œ 4ë¡œ ë³€ê²½
```

```bash
# ë³€ê²½ëœ YAML íŒŒì¼ ì ìš©
kubectl apply -f nginx-deployment.yaml

# ë³€ê²½ ì‚¬í•­ í™•ì¸
kubectl get deployment nginx-deployment
```

## ğŸ› ï¸ 5.6 ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ íƒ€ì… ë°°í¬

### ë°±ì—”ë“œ API ì„œë²„ ë°°í¬ ì˜ˆì‹œ
```yaml
# api-server-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-server
spec:
  replicas: 2
  selector:
    matchLabels:
      app: api-server
  template:
    metadata:
      labels:
        app: api-server
    spec:
      containers:
      - name: api-server
        image: node:16-alpine
        command: ["node"]
        args: ["-e", "const http = require('http'); const server = http.createServer((req, res) => { res.writeHead(200, {'Content-Type': 'application/json'}); res.end(JSON.stringify({message: 'Hello from API Server', pod: process.env.HOSTNAME})); }); server.listen(3000, () => console.log('Server running on port 3000'));"]
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
---
apiVersion: v1
kind: Service
metadata:
  name: api-server-service
spec:
  selector:
    app: api-server
  ports:
  - port: 80
    targetPort: 3000
  type: LoadBalancer
```

### ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬ ì˜ˆì‹œ (ê°œë°œìš©)
```yaml
# mysql-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "password123"
        - name: MYSQL_DATABASE
          value: "testdb"
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-storage
          mountPath: /var/lib/mysql
      volumes:
      - name: mysql-storage
        emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
spec:
  selector:
    app: mysql
  ports:
  - port: 3306
    targetPort: 3306
  type: ClusterIP  # ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
```

## ğŸ” 5.7 ë¬¸ì œ í•´ê²° ë° ë””ë²„ê¹…

### ì¼ë°˜ì ì¸ ë¬¸ì œ ìƒí™©ë“¤

#### Podê°€ Pending ìƒíƒœì¸ ê²½ìš°
```bash
# Pod ìƒíƒœ í™•ì¸
kubectl get pods
# NAME                                READY   STATUS    RESTARTS   AGE
# nginx-deployment-xxxxxxxxxx-xxxxx   0/1     Pending   0          5m

# ìƒì„¸ ì •ë³´ë¡œ ì›ì¸ íŒŒì•…
kubectl describe pod nginx-deployment-xxxxxxxxxx-xxxxx
# Events ì„¹ì…˜ì—ì„œ ì›ì¸ í™•ì¸:
# - ë¦¬ì†ŒìŠ¤ ë¶€ì¡± (CPU/Memory)
# - ë…¸ë“œ ì„ íƒ ì¡°ê±´ ë¶ˆë§Œì¡±
# - ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì‹¤íŒ¨ ë“±
```

#### Podê°€ CrashLoopBackOff ìƒíƒœì¸ ê²½ìš°
```bash
# ë¡œê·¸ í™•ì¸
kubectl logs nginx-deployment-xxxxxxxxxx-xxxxx

# ì´ì „ ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
kubectl logs nginx-deployment-xxxxxxxxxx-xxxxx --previous

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ê·¼í•˜ì—¬ ë””ë²„ê¹…
kubectl exec -it nginx-deployment-xxxxxxxxxx-xxxxx -- /bin/bash
```

#### Service ì ‘ê·¼ì´ ì•ˆ ë˜ëŠ” ê²½ìš°
```bash
# Serviceì™€ Podì˜ ë¼ë²¨ ë§¤ì¹­ í™•ì¸
kubectl get service nginx-service -o yaml
kubectl get pods --show-labels

# ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
kubectl get endpoints nginx-service

# í¬íŠ¸ í¬ì›Œë”©ìœ¼ë¡œ ì§ì ‘ í…ŒìŠ¤íŠ¸
kubectl port-forward service/nginx-service 8080:80
# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8080 ì ‘ê·¼
```

### ìœ ìš©í•œ ë””ë²„ê¹… ëª…ë ¹ì–´
```bash
# í´ëŸ¬ìŠ¤í„° ì „ì²´ ì´ë²¤íŠ¸ í™•ì¸
kubectl get events --sort-by=.metadata.creationTimestamp

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top pods
kubectl top nodes

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl run test-pod --image=busybox --rm -it --restart=Never -- /bin/sh
# Pod ë‚´ë¶€ì—ì„œ nslookup, wget ë“±ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
```

## ğŸ¯ 5ë‹¨ê³„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ ë°°í¬ ì™„ë£Œ
- [ ] YAML íŒŒì¼ë¡œ Deployment ìƒì„± ì„±ê³µ
- [ ] Serviceë¡œ ì™¸ë¶€ ì ‘ê·¼ ì„¤ì • ì„±ê³µ
- [ ] LoadBalancerë¥¼ í†µí•œ ì™¸ë¶€ ì ‘ê·¼ í™•ì¸
- [ ] ì—¬ëŸ¬ Pod ê°„ ë¡œë“œ ë°¸ëŸ°ì‹± ë™ì‘ í™•ì¸

### ìš´ì˜ ê¸°ëŠ¥ í™•ì¸
- [ ] ë¡¤ë§ ì—…ë°ì´íŠ¸ ì‹¤í–‰ ë° í™•ì¸
- [ ] ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§ (í™•ì¥/ì¶•ì†Œ) ì„±ê³µ
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸ ê°€ëŠ¥
- [ ] ê¸°ë³¸ì ì¸ ë¬¸ì œ í•´ê²° ë°©ë²• ìˆ™ì§€

### ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ íƒ€ì…
- [ ] ì›¹ ì„œë²„ (nginx) ë°°í¬ ì„±ê³µ
- [ ] API ì„œë²„ ë°°í¬ ì„±ê³µ (ì„ íƒì‚¬í•­)
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬ ì„±ê³µ (ì„ íƒì‚¬í•­)

### ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹…
- [ ] kubectlì„ ì‚¬ìš©í•œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥
- [ ] ë¡œê·¸ í™•ì¸ ë° ë¶„ì„ ê°€ëŠ¥
- [ ] ê¸°ë³¸ì ì¸ ë¬¸ì œ ìƒí™© ëŒ€ì‘ ê°€ëŠ¥

## ğŸ’¡ ì‹¤ìŠµ íŒ

### íš¨ìœ¨ì ì¸ ê°œë°œ ì›Œí¬í”Œë¡œìš°
```bash
# ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ë“¤ì„ aliasë¡œ ì„¤ì •
alias k='kubectl'
alias kgp='kubectl get pods'
alias kgs='kubectl get services'
alias kgd='kubectl get deployments'

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ ì‘ì—…
kubectl create namespace dev
kubectl apply -f nginx-deployment.yaml -n dev
```

### YAML íŒŒì¼ ê´€ë¦¬
```bash
# ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ í•˜ë‚˜ì˜ íŒŒì¼ì— ì‘ì„± (--- êµ¬ë¶„ì ì‚¬ìš©)
# all-in-one.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
# ... deployment ë‚´ìš©
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
# ... service ë‚´ìš©
```

## ğŸ¤” ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

**Q: Podê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ë•Œ ë¡œê·¸ë¥¼ ì–´ë–»ê²Œ í™•ì¸í•˜ë‚˜ìš”?**
A: `kubectl logs -l app=nginx --tail=10`ìœ¼ë¡œ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ Pod ë¡œê·¸ë¥¼ ë™ì‹œì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Q: ë°°í¬í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ë˜ì§€ ì•Šì•„ìš”.**
A: Service íƒ€ì…ì´ LoadBalancerì¸ì§€, External IPê°€ í• ë‹¹ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , AWS ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •ë„ ì ê²€í•´ë³´ì„¸ìš”.

**Q: ë¡¤ë§ ì—…ë°ì´íŠ¸ ì¤‘ì— ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ë‚˜ìš”?**
A: ì•„ë‹ˆìš”. ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ìƒˆ Podê°€ ì¤€ë¹„ëœ í›„ ê¸°ì¡´ Podë¥¼ ì¢…ë£Œí•˜ë¯€ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

**ë‹¤ìŒ ë‹¨ê³„**: [07-ëª¨ë‹ˆí„°ë§ê³¼-ë¡œê¹….md](./07-ëª¨ë‹ˆí„°ë§ê³¼-ë¡œê¹….md)ë¡œ ì´ë™í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§ ë°©ë²•ì„ í•™ìŠµí•˜ì„¸ìš”.