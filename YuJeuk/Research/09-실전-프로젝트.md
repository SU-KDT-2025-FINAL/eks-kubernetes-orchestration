# ì‹¤ì „ í”„ë¡œì íŠ¸

## ğŸ—ï¸ 8.1 í”„ë¡œì íŠ¸ ê°œìš”: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¸”ë¡œê·¸ í”Œë«í¼

### í”„ë¡œì íŠ¸ êµ¬ì¡°
```
Blog Platform Architecture
â”œâ”€â”€ Frontend (React)
â”‚   â”œâ”€â”€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
â”‚   â””â”€â”€ ì •ì  íŒŒì¼ ì„œë¹™
â”œâ”€â”€ API Gateway (Nginx)
â”‚   â”œâ”€â”€ ë¼ìš°íŒ… ë° ë¡œë“œ ë°¸ëŸ°ì‹±
â”‚   â””â”€â”€ SSL ì¢…ë£Œ
â”œâ”€â”€ Backend Services
â”‚   â”œâ”€â”€ User Service (Node.js)
â”‚   â”œâ”€â”€ Post Service (Python)
â”‚   â””â”€â”€ Comment Service (Go)
â”œâ”€â”€ Database Layer
â”‚   â”œâ”€â”€ PostgreSQL (ì‚¬ìš©ì ë°ì´í„°)
â”‚   â”œâ”€â”€ MongoDB (í¬ìŠ¤íŠ¸ ë°ì´í„°)
â”‚   â””â”€â”€ Redis (ìºì‹œ)
â””â”€â”€ Monitoring & Logging
    â”œâ”€â”€ Prometheus
    â”œâ”€â”€ Grafana
    â””â”€â”€ ELK Stack
```

### í•™ìŠµ ëª©í‘œ
- ì‹¤ì œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ êµ¬í˜„
- ì„œë¹„ìŠ¤ ê°„ í†µì‹  ë° ë°ì´í„° ê´€ë¦¬
- CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•
- ë³´ì•ˆ ë° ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©

## ğŸš€ 8.2 ë‹¨ê³„ë³„ êµ¬í˜„

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ êµ¬ì„±

#### ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° ê¸°ë³¸ ì„¤ì •
```yaml
# namespaces.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: blog-platform
  labels:
    name: blog-platform
---
apiVersion: v1
kind: Namespace
metadata:
  name: blog-monitoring
  labels:
    name: blog-monitoring
---
apiVersion: v1
kind: Namespace
metadata:
  name: blog-database
  labels:
    name: blog-database
```

#### ConfigMap ë° Secret ì„¤ì •
```yaml
# config-secrets.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: blog-platform
data:
  NODE_ENV: "production"
  API_VERSION: "v1"
  CORS_ORIGIN: "*"
  LOG_LEVEL: "info"
  REDIS_HOST: "redis-service.blog-database.svc.cluster.local"
  POSTGRES_HOST: "postgres-service.blog-database.svc.cluster.local"
  MONGODB_HOST: "mongodb-service.blog-database.svc.cluster.local"
---
apiVersion: v1
kind: Secret
metadata:
  name: db-secrets
  namespace: blog-platform
type: Opaque
data:
  postgres-user: YmxvZ3VzZXI=  # bloguser
  postgres-password: c2VjdXJlcGFzcw==  # securepass
  mongodb-user: YmxvZ3VzZXI=  # bloguser
  mongodb-password: c2VjdXJlcGFzcw==  # securepass
  redis-password: cmVkaXNwYXNz  # redispass
  jwt-secret: bXlzdXBlcnNlY3JldGp3dGtleQ==  # mysupersecretjwtkey
```

### Phase 2: ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ êµ¬ì¶•

#### PostgreSQL ë°°í¬ (ì‚¬ìš©ì ì„œë¹„ìŠ¤ìš©)
```yaml
# postgres.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
  namespace: blog-database
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: gp2
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres
  namespace: blog-database
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_DB
          value: "blogdb"
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: postgres-user
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: postgres-password
        ports:
        - containerPort: 5432
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
      volumes:
      - name: postgres-storage
        persistentVolumeClaim:
          claimName: postgres-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: postgres-service
  namespace: blog-database
spec:
  selector:
    app: postgres
  ports:
  - port: 5432
    targetPort: 5432
  type: ClusterIP
```

#### MongoDB ë°°í¬ (í¬ìŠ¤íŠ¸ ì„œë¹„ìŠ¤ìš©)
```yaml
# mongodb.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mongodb-pvc
  namespace: blog-database
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: gp2
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mongodb
  namespace: blog-database
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongodb
        image: mongo:5.0
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: mongodb-user
        - name: MONGO_INITDB_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: mongodb-password
        - name: MONGO_INITDB_DATABASE
          value: "blogdb"
        ports:
        - containerPort: 27017
        volumeMounts:
        - name: mongodb-storage
          mountPath: /data/db
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
      volumes:
      - name: mongodb-storage
        persistentVolumeClaim:
          claimName: mongodb-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: mongodb-service
  namespace: blog-database
spec:
  selector:
    app: mongodb
  ports:
  - port: 27017
    targetPort: 27017
  type: ClusterIP
```

#### Redis ë°°í¬ (ìºì‹œìš©)
```yaml
# redis.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis
  namespace: blog-database
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis:6.2-alpine
        command:
        - redis-server
        - --requirepass
        - $(REDIS_PASSWORD)
        env:
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: redis-password
        ports:
        - containerPort: 6379
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
---
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: blog-database
spec:
  selector:
    app: redis
  ports:
  - port: 6379
    targetPort: 6379
  type: ClusterIP
```

### Phase 3: ë°±ì—”ë“œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¶•

#### User Service (Node.js)
```yaml
# user-service.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
  namespace: blog-platform
spec:
  replicas: 2
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: node:16-alpine
        command: ["sh", "-c"]
        args:
        - |
          cat > package.json << 'EOF'
          {
            "name": "user-service",
            "version": "1.0.0",
            "main": "server.js",
            "dependencies": {
              "express": "^4.18.0",
              "pg": "^8.7.0",
              "bcrypt": "^5.0.0",
              "jsonwebtoken": "^8.5.0",
              "cors": "^2.8.0"
            }
          }
          EOF
          
          cat > server.js << 'EOF'
          const express = require('express');
          const { Pool } = require('pg');
          const bcrypt = require('bcrypt');
          const jwt = require('jsonwebtoken');
          const cors = require('cors');
          
          const app = express();
          app.use(cors());
          app.use(express.json());
          
          const pool = new Pool({
            host: process.env.POSTGRES_HOST,
            user: process.env.POSTGRES_USER,
            password: process.env.POSTGRES_PASSWORD,
            database: 'blogdb',
            port: 5432,
          });
          
          // Health check
          app.get('/health', (req, res) => {
            res.json({ status: 'healthy', service: 'user-service' });
          });
          
          // User registration
          app.post('/api/users/register', async (req, res) => {
            try {
              const { username, email, password } = req.body;
              const hashedPassword = await bcrypt.hash(password, 10);
              
              const result = await pool.query(
                'INSERT INTO users (username, email, password) VALUES ($1, $2, $3) RETURNING id, username, email',
                [username, email, hashedPassword]
              );
              
              res.status(201).json(result.rows[0]);
            } catch (error) {
              res.status(500).json({ error: error.message });
            }
          });
          
          // User login
          app.post('/api/users/login', async (req, res) => {
            try {
              const { email, password } = req.body;
              
              const result = await pool.query('SELECT * FROM users WHERE email = $1', [email]);
              if (result.rows.length === 0) {
                return res.status(401).json({ error: 'Invalid credentials' });
              }
              
              const user = result.rows[0];
              const validPassword = await bcrypt.compare(password, user.password);
              
              if (!validPassword) {
                return res.status(401).json({ error: 'Invalid credentials' });
              }
              
              const token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET);
              res.json({ token, user: { id: user.id, username: user.username, email: user.email } });
            } catch (error) {
              res.status(500).json({ error: error.message });
            }
          });
          
          const PORT = process.env.PORT || 3001;
          app.listen(PORT, () => {
            console.log(`User service running on port ${PORT}`);
          });
          EOF
          
          npm install
          node server.js
        env:
        - name: POSTGRES_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: POSTGRES_HOST
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: postgres-user
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: postgres-password
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: jwt-secret
        ports:
        - containerPort: 3001
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3001
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 3001
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: user-service
  namespace: blog-platform
spec:
  selector:
    app: user-service
  ports:
  - port: 80
    targetPort: 3001
  type: ClusterIP
```

#### Post Service (Python/FastAPI)
```yaml
# post-service.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: post-service
  namespace: blog-platform
spec:
  replicas: 2
  selector:
    matchLabels:
      app: post-service
  template:
    metadata:
      labels:
        app: post-service
    spec:
      containers:
      - name: post-service
        image: python:3.9-slim
        command: ["sh", "-c"]
        args:
        - |
          pip install fastapi uvicorn pymongo python-multipart
          
          cat > main.py << 'EOF'
          from fastapi import FastAPI, HTTPException
          from pymongo import MongoClient
          from bson import ObjectId
          import os
          from datetime import datetime
          
          app = FastAPI()
          
          # MongoDB connection
          client = MongoClient(f"mongodb://{os.getenv('MONGODB_USER')}:{os.getenv('MONGODB_PASSWORD')}@{os.getenv('MONGODB_HOST')}:27017/")
          db = client.blogdb
          posts_collection = db.posts
          
          @app.get("/health")
          def health_check():
              return {"status": "healthy", "service": "post-service"}
          
          @app.post("/api/posts")
          def create_post(post_data: dict):
              post_data["created_at"] = datetime.utcnow()
              post_data["updated_at"] = datetime.utcnow()
              result = posts_collection.insert_one(post_data)
              return {"id": str(result.inserted_id), "message": "Post created successfully"}
          
          @app.get("/api/posts")
          def get_posts():
              posts = list(posts_collection.find())
              for post in posts:
                  post["_id"] = str(post["_id"])
              return posts
          
          @app.get("/api/posts/{post_id}")
          def get_post(post_id: str):
              post = posts_collection.find_one({"_id": ObjectId(post_id)})
              if post:
                  post["_id"] = str(post["_id"])
                  return post
              raise HTTPException(status_code=404, detail="Post not found")
          
          @app.put("/api/posts/{post_id}")
          def update_post(post_id: str, post_data: dict):
              post_data["updated_at"] = datetime.utcnow()
              result = posts_collection.update_one(
                  {"_id": ObjectId(post_id)}, 
                  {"$set": post_data}
              )
              if result.modified_count:
                  return {"message": "Post updated successfully"}
              raise HTTPException(status_code=404, detail="Post not found")
          
          @app.delete("/api/posts/{post_id}")
          def delete_post(post_id: str):
              result = posts_collection.delete_one({"_id": ObjectId(post_id)})
              if result.deleted_count:
                  return {"message": "Post deleted successfully"}
              raise HTTPException(status_code=404, detail="Post not found")
          EOF
          
          uvicorn main:app --host 0.0.0.0 --port 3002
        env:
        - name: MONGODB_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: MONGODB_HOST
        - name: MONGODB_USER
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: mongodb-user
        - name: MONGODB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: mongodb-password
        ports:
        - containerPort: 3002
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3002
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 3002
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: post-service
  namespace: blog-platform
spec:
  selector:
    app: post-service
  ports:
  - port: 80
    targetPort: 3002
  type: ClusterIP
```

### Phase 4: API Gateway ë° í”„ë¡ íŠ¸ì—”ë“œ

#### Nginx API Gateway
```yaml
# api-gateway.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: blog-platform
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    
    http {
        upstream user-service {
            server user-service.blog-platform.svc.cluster.local:80;
        }
        
        upstream post-service {
            server post-service.blog-platform.svc.cluster.local:80;
        }
        
        server {
            listen 80;
            
            location /api/users/ {
                proxy_pass http://user-service/api/users/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /api/posts/ {
                proxy_pass http://post-service/api/posts/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /health {
                return 200 "API Gateway is healthy\n";
                add_header Content-Type text/plain;
            }
        }
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
  namespace: blog-platform
spec:
  replicas: 2
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
    spec:
      containers:
      - name: nginx
        image: nginx:1.21-alpine
        ports:
        - containerPort: 80
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-config
---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: blog-platform
spec:
  selector:
    app: api-gateway
  ports:
  - port: 80
    targetPort: 80
  type: LoadBalancer
```

### Phase 5: HPA ë° ëª¨ë‹ˆí„°ë§ ì„¤ì •

#### HPA ì„¤ì •
```yaml
# hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: user-service-hpa
  namespace: blog-platform
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: user-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: post-service-hpa
  namespace: blog-platform
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: post-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

## ğŸ”„ 8.3 CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### GitHub Actions ì›Œí¬í”Œë¡œìš°
```yaml
# .github/workflows/deploy.yml
name: Deploy to EKS

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  AWS_REGION: ap-northeast-2
  EKS_CLUSTER_NAME: my-first-cluster

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Login to Amazon ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Build, tag, and push image to Amazon ECR
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        ECR_REPOSITORY: blog-platform
        IMAGE_TAG: ${{ github.sha }}
      run: |
        docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG

    - name: Update kube config
      run: aws eks update-kubeconfig --name $EKS_CLUSTER_NAME --region $AWS_REGION

    - name: Deploy to EKS
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        ECR_REPOSITORY: blog-platform
        IMAGE_TAG: ${{ github.sha }}
      run: |
        sed -i.bak "s|DOCKER_IMAGE|$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG|g" k8s/*.yaml
        kubectl apply -f k8s/
        kubectl rollout status deployment/user-service -n blog-platform
        kubectl rollout status deployment/post-service -n blog-platform
```

### ArgoCDë¥¼ ì‚¬ìš©í•œ GitOps (ê³ ê¸‰)
```yaml
# argocd-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: blog-platform
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/your-username/blog-platform-k8s
    targetRevision: HEAD
    path: k8s
  destination:
    server: https://kubernetes.default.svc
    namespace: blog-platform
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
```

## ğŸ“Š 8.4 ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì‹œìŠ¤í…œ

### Prometheus ë° Grafana ì„¤ì •
```bash
# Prometheus ì„¤ì¹˜
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace blog-monitoring \
  --create-namespace \
  --values prometheus-values.yaml
```

```yaml
# prometheus-values.yaml
prometheus:
  prometheusSpec:
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    retention: 30d
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi

grafana:
  adminPassword: admin123
  service:
    type: LoadBalancer
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default
```

### ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ
```json
{
  "dashboard": {
    "title": "Blog Platform Dashboard",
    "panels": [
      {
        "title": "Service Response Time",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, service))",
            "legendFormat": "{{ service }} - 95th percentile"
          }
        ]
      },
      {
        "title": "Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m])) by (service)",
            "legendFormat": "{{ service }}"
          }
        ]
      },
      {
        "title": "Error Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) by (service) / sum(rate(http_requests_total[5m])) by (service)",
            "legendFormat": "{{ service }} error rate"
          }
        ]
      }
    ]
  }
}
```

## ğŸ”’ 8.5 ë³´ì•ˆ ê°•í™”

### RBAC ì„¤ì •
```yaml
# rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: blog-platform-sa
  namespace: blog-platform
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: blog-platform
  name: blog-platform-role
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps", "secrets"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: blog-platform-rolebinding
  namespace: blog-platform
subjects:
- kind: ServiceAccount
  name: blog-platform-sa
  namespace: blog-platform
roleRef:
  kind: Role
  name: blog-platform-role
  apiGroup: rbac.authorization.k8s.io
```

### ë„¤íŠ¸ì›Œí¬ ì •ì±…
```yaml
# network-policy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: blog-platform-netpol
  namespace: blog-platform
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: blog-platform
    - namespaceSelector:
        matchLabels:
          name: blog-database
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: blog-database
  - to: []
    ports:
    - protocol: TCP
      port: 53
    - protocol: UDP
      port: 53
```

### Pod Security Standards
```yaml
# pod-security.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: blog-platform
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
```

## ğŸ§ª 8.6 í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### ë¶€í•˜ í…ŒìŠ¤íŠ¸
```bash
# Apache Benchë¥¼ ì‚¬ìš©í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸
kubectl run load-test --image=httpd:2.4-alpine --rm -it --restart=Never -- /bin/sh

# Pod ë‚´ì—ì„œ ì‹¤í–‰
ab -n 1000 -c 10 http://api-gateway.blog-platform.svc.cluster.local/api/posts/

# ë˜ëŠ” ì™¸ë¶€ì—ì„œ LoadBalancer IPë¡œ í…ŒìŠ¤íŠ¸
ab -n 1000 -c 10 http://YOUR_LOADBALANCER_IP/api/posts/
```

### ì¥ì•  ë³µêµ¬ í…ŒìŠ¤íŠ¸
```bash
# íŠ¹ì • ì„œë¹„ìŠ¤ Pod ì‚­ì œí•˜ì—¬ ìë™ ë³µêµ¬ í…ŒìŠ¤íŠ¸
kubectl delete pod -l app=user-service -n blog-platform

# ë…¸ë“œ ì¥ì•  ì‹œë®¬ë ˆì´ì…˜
kubectl drain NODE_NAME --ignore-daemonsets --delete-emptydir-data

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¥ì•  í…ŒìŠ¤íŠ¸
kubectl scale deployment postgres --replicas=0 -n blog-database
# ì„œë¹„ìŠ¤ ë™ì‘ í™•ì¸ í›„ ë³µêµ¬
kubectl scale deployment postgres --replicas=1 -n blog-database
```

## ğŸ¯ 8ë‹¨ê³„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì¸í”„ë¼ êµ¬ì„±
- [ ] ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¶„ë¦¬ ë° ê¸°ë³¸ ì„¤ì • ì™„ë£Œ
- [ ] ConfigMapê³¼ Secretì„ í†µí•œ ì„¤ì • ê´€ë¦¬
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ êµ¬ì¶• (PostgreSQL, MongoDB, Redis)

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬í˜„
- [ ] User Service ë°°í¬ ë° ë™ì‘ í™•ì¸
- [ ] Post Service ë°°í¬ ë° ë™ì‘ í™•ì¸
- [ ] API Gatewayë¥¼ í†µí•œ ë¼ìš°íŒ… ì„¤ì •
- [ ] ì„œë¹„ìŠ¤ ê°„ í†µì‹  í™•ì¸

### ìš´ì˜ ê¸°ëŠ¥
- [ ] HPA ì„¤ì • ë° ìë™ ìŠ¤ì¼€ì¼ë§ í…ŒìŠ¤íŠ¸
- [ ] í—¬ìŠ¤ ì²´í¬ ë° í”„ë¡œë¸Œ ì„¤ì •
- [ ] ë¦¬ì†ŒìŠ¤ ì œí•œ ë° ìš”ì²­ ì„¤ì •

### CI/CD íŒŒì´í”„ë¼ì¸
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° ì„¤ì •
- [ ] ìë™ ë¹Œë“œ ë° ë°°í¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- [ ] ë¡¤ë§ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸

### ëª¨ë‹ˆí„°ë§ ë° ë³´ì•ˆ
- [ ] Prometheus ë° Grafana ì„¤ì¹˜
- [ ] ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ ìƒì„±
- [ ] RBAC ë° ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©
- [ ] ë³´ì•ˆ ìŠ¤ìº” ë° ì·¨ì•½ì  ì ê²€

### í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ì¥ì•  ë³µêµ¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸

## ğŸ’¡ í”„ë¡œì íŠ¸ í™•ì¥ ì•„ì´ë””ì–´

### ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„
1. **Comment Service**: Goë¡œ ëŒ“ê¸€ ì„œë¹„ìŠ¤ êµ¬í˜„
2. **File Upload Service**: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° S3 ì—°ë™
3. **Notification Service**: ì‹¤ì‹œê°„ ì•Œë¦¼ (WebSocket)
4. **Search Service**: Elasticsearch ê¸°ë°˜ ê²€ìƒ‰

### ê³ ê¸‰ ìš´ì˜ ê¸°ëŠ¥
1. **Service Mesh**: Istio ë„ì…ìœ¼ë¡œ íŠ¸ë˜í”½ ê´€ë¦¬
2. **Chaos Engineering**: Chaos Monkey ë„ì…
3. **Multi-region Deployment**: ë‹¤ì¤‘ ë¦¬ì „ ë°°í¬
4. **Backup & Disaster Recovery**: ë°±ì—… ë° ì¬í•´ ë³µêµ¬ ì „ëµ

## ğŸ¤” ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
1. **ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì‹¤íŒ¨**: DNS ì´ë¦„ í™•ì¸, ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ê²€
2. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨**: Secret ì„¤ì •, ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
3. **HPA ë™ì‘ ì•ˆ í•¨**: Metrics Server ì„¤ì¹˜, ë¦¬ì†ŒìŠ¤ ìš”ì²­ ì„¤ì • í™•ì¸
4. **CI/CD íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨**: AWS ê¶Œí•œ, ECR ì„¤ì • í™•ì¸

### ë””ë²„ê¹… ëª…ë ¹ì–´
```bash
# ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
kubectl get all --all-namespaces

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
kubectl logs -f deployment/user-service -n blog-platform

# ì„œë¹„ìŠ¤ ê°„ ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl exec -it deployment/api-gateway -n blog-platform -- wget -qO- http://user-service/health

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
kubectl top pods --all-namespaces
```

---

**ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸ‰ ì‹¤ì „ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ EKSì™€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ í•µì‹¬ ê°œë…ë“¤ì„ ëª¨ë‘ ê²½í—˜í•´ë³´ì…¨ìŠµë‹ˆë‹¤. ì´ì œ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì„ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ì‹¤ë ¥ì„ ê°–ì¶”ì…¨ìŠµë‹ˆë‹¤!